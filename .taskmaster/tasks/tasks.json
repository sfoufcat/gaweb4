{
  "master": {
    "tasks": [
      {
        "id": "102",
        "title": "Fix calculateDateForProgramDay null check bug",
        "description": "Fix the critical RangeError crash in calculateDateForProgramDay when enrollment.startedAt is undefined",
        "details": "In src/lib/program-engine.ts line 2671, add null/undefined checks for startDateStr parameter. Add validation using isNaN(startDate.getTime()) for invalid Date objects. Return null instead of crashing and add console.warn logging for debugging. This is blocking coach-to-client sync functionality.",
        "testStrategy": "Test with enrollments that have undefined/null startedAt values. Verify function returns null instead of throwing RangeError. Confirm coach sync no longer fails silently.",
        "priority": "high",
        "dependencies": [],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T12:45:17.406Z"
      },
      {
        "id": "103",
        "title": "Implement lazy sync on app task fetch",
        "description": "Add automatic program task sync when users fetch their tasks if no program tasks exist for today",
        "details": "Modify src/app/api/tasks/route.ts GET endpoint. Check if user has active program enrollment and if tasks for today exist with source: 'program'. If no program tasks exist, call syncProgramV2TasksForToday(userId) in background. Handle errors gracefully without breaking task fetch response. This provides timezone-aware sync when users actually need tasks.",
        "testStrategy": "Test with users who have active enrollments but no tasks for today. Verify tasks are created automatically on first app open. Confirm no duplicate tasks are created on subsequent fetches.",
        "priority": "high",
        "dependencies": [
          "102"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T12:45:17.407Z"
      },
      {
        "id": "104",
        "title": "Create backup cron job for program sync",
        "description": "Implement a backup cron job that runs every 6 hours to sync program tasks for users who haven't opened the app",
        "details": "Create src/app/api/cron/programs-daily-sync/route.ts with POST handler. Fetch all active enrollments, check if users have program tasks for today, sync if missing using syncProgramV2TasksForToday(userId). Implement batching for scale (process in chunks of 100). Add rate limiting and comprehensive logging. Update vercel.json with schedule '0 */6 * * *'.",
        "testStrategy": "Test cron endpoint manually with various enrollment states. Verify batching works with large datasets. Confirm only users without today's tasks are processed. Test error handling doesn't stop processing other users.",
        "priority": "medium",
        "dependencies": [
          "102"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T12:45:17.409Z"
      },
      {
        "id": "105",
        "title": "Add sync on program enrollment",
        "description": "Automatically sync Day 1 tasks when users enroll in programs with start dates today or in the past",
        "details": "Modify src/app/api/programs/enroll/route.ts and src/app/api/programs/complete-enrollment/route.ts. After creating enrollment with status === 'active', check if start date (cohort.startDate or enrollment.startedAt) is today or past. If so, call syncProgramV2TasksForToday(userId). Handle errors gracefully - enrollment should succeed even if sync fails.",
        "testStrategy": "Test enrollment flow with programs starting today, in past, and future. Verify Day 1 tasks appear immediately for eligible enrollments. Confirm enrollment succeeds even if sync fails.",
        "priority": "high",
        "dependencies": [
          "102"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T12:45:17.410Z"
      },
      {
        "id": "106",
        "title": "Fix cross-program task interference",
        "description": "Prevent Program B sync from deleting Program A tasks by adding programEnrollmentId filter",
        "details": "In src/lib/program-engine.ts syncProgramTasksToClientDay() lines 2436-2454, modify the task deletion filter to include programEnrollmentId. Only delete tasks from the current program enrollment, not all program-sourced tasks. Add fallback for legacy tasks without programEnrollmentId.",
        "testStrategy": "Test with user enrolled in multiple programs. Sync Program B and verify Program A tasks remain intact. Test with legacy tasks without programEnrollmentId to ensure backward compatibility.",
        "priority": "medium",
        "dependencies": [
          "102"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T12:45:17.413Z"
      },
      {
        "id": "107",
        "title": "Implement client-to-coach completion sync",
        "description": "Show client task completion status to coaches in 1:1 program view",
        "details": "Modify src/app/api/coach/org-programs/[programId]/client-days/route.ts to fetch user's tasks for each day's date. Match user tasks by title === template.label and merge completion status (completed, completedAt, taskId) into template tasks. Add optional completion fields to ProgramTaskTemplate type in src/types/index.ts. Update CoachProgramsTab.tsx UI to show checkmarks for completed tasks.",
        "testStrategy": "Test with 1:1 program where client has completed some tasks. Verify coach sees checkmarks on completed tasks. Test completion status updates on refresh.",
        "priority": "medium",
        "dependencies": [
          "102"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T12:45:17.413Z"
      },
      {
        "id": "108",
        "title": "Add cohort completion threshold UI",
        "description": "Create UI for coaches to configure cohortCompletionThreshold percentage for group programs",
        "details": "Add threshold slider (0-100%, step 5) in src/components/coach/programs/ProgramSettingsModal.tsx for group programs only. Include quick select buttons for 0%, 25%, 50%, 75%, 100%. Add handler in CoachProgramsTab.tsx to save threshold via PUT /api/coach/org-programs/[programId]. Only save on slider release, not on every drag.",
        "testStrategy": "Test slider appears only for group programs. Verify threshold persists after save. Test quick select buttons set correct values. Confirm slider doesn't trigger saves during drag.",
        "priority": "low",
        "dependencies": [],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T12:45:17.414Z"
      },
      {
        "id": "109",
        "title": "Add evergreen program cycle indicator UI",
        "description": "Display evergreen badge and current cycle number for evergreen programs",
        "details": "Add evergreen badge (green cycle icon) in program header after Group/1:1 badge in CoachProgramsTab.tsx. Add cycle indicator below weeks sidebar showing 'Cycle X' in ModuleWeeksSidebar.tsx. Create calculateCyclesSinceDate() helper in program-client-utils.ts. Use different cycle sources: template (createdAt), client (enrollment.currentCycleNumber), cohort (cohort.startDate).",
        "testStrategy": "Test badge appears for all evergreen programs. Verify cycle number displays correctly in template, client, and cohort modes. Test with both weekday-only and include-weekends programs.",
        "priority": "low",
        "dependencies": [],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T12:45:17.415Z"
      },
      {
        "id": "110",
        "title": "Add cycleNumber field to Task interface and sync logic",
        "description": "Add cycleNumber field to tasks for evergreen programs to enable cycle-based filtering",
        "details": "Add cycleNumber?: number field to Task interface in src/types/index.ts. In syncProgramV2TasksForToday() and syncProgramTasksToClientDay(), set cycleNumber ONLY for program-sourced tasks (sourceType is 'program', 'program_day', 'program_week', 'coach_manual') AND durationType is 'evergreen'. Use enrollment.currentCycleNumber as value. Do NOT add to user-created tasks or fixed-duration programs.",
        "testStrategy": "Test new evergreen program tasks have cycleNumber field. Verify user-created tasks and fixed-duration program tasks are unaffected. Confirm legacy tasks without cycleNumber are treated as cycle 1.",
        "priority": "medium",
        "dependencies": [
          "102"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T12:48:33.263Z"
      },
      {
        "id": "111",
        "title": "Convert cycle indicator to dropdown with pagination",
        "description": "Replace static cycle indicator with dropdown for selecting and viewing different cycles",
        "details": "In ModuleWeeksSidebar.tsx, replace static 'Cycle X' button with dropdown trigger. Show cycles 1 through currentCycleNumber (newest first) with 5-cycle pagination. Add '↑ Newer cycles' / '↓ Older cycles' buttons. Highlight selected cycle with checkmark, mark current cycle with '(current)' label. Use emerald background with RefreshCw + ChevronDown icons. Only show for durationType: 'evergreen' programs.",
        "testStrategy": "Test dropdown appears for evergreen programs only. Verify pagination works with more than 5 cycles. Confirm selected cycle is highlighted and current cycle is marked. Test dropdown styling matches specifications.",
        "priority": "medium",
        "dependencies": [
          "109",
          "110"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T12:50:36.796Z"
      },
      {
        "id": "112",
        "title": "Implement cycle state management",
        "description": "Add selectedCycle state management and prop passing for cycle selection functionality",
        "details": "Add selectedCycle state in CoachProgramsTab.tsx (defaults to currentCycleNumber). Reset selectedCycle when enrollment changes. Pass selectedCycle, onCycleSelect, and maxCycleNumber (from enrollment.currentCycleNumber) to ModuleWeeksSidebar. Implement cycle selection handler that updates state and triggers view refresh.",
        "testStrategy": "Test selectedCycle defaults to current cycle. Verify state resets when switching between enrollments. Confirm cycle selection updates the state and triggers appropriate view changes.",
        "priority": "medium",
        "dependencies": [
          "111"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T12:52:28.071Z"
      },
      {
        "id": "113",
        "title": "Implement cycle-based task filtering",
        "description": "Filter displayed tasks based on selected cycle for evergreen programs",
        "details": "When displaying client tasks in CoachProgramsTab.tsx, filter by selectedCycle. Tasks without cycleNumber are treated as cycle 1. Apply cycle filter only in client/cohort mode, not template mode. Ensure filtering works with existing task display logic and doesn't break other functionality.",
        "testStrategy": "Test cycle filtering shows only tasks from selected cycle. Verify tasks without cycleNumber appear in cycle 1. Confirm template mode is unaffected by cycle filtering. Test switching between cycles updates task display correctly.",
        "priority": "medium",
        "dependencies": [
          "112"
        ],
        "status": "in-progress",
        "subtasks": [],
        "updatedAt": "2026-01-08T12:52:28.081Z"
      },
      {
        "id": "114",
        "title": "Update vercel.json with cron configuration",
        "description": "Add cron job schedule configuration to vercel.json for the backup program sync",
        "details": "Add cron configuration to vercel.json with schedule '0 */6 * * *' pointing to /api/cron/programs-daily-sync endpoint. Ensure proper cron syntax and verify the schedule runs every 6 hours (0:00, 6:00, 12:00, 18:00 UTC). Include any necessary environment variable configurations.",
        "testStrategy": "Verify vercel.json syntax is correct. Test cron schedule triggers at expected intervals in staging environment. Confirm endpoint is accessible and responds correctly to cron requests.",
        "priority": "medium",
        "dependencies": [
          "104"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-08T12:45:17.415Z"
      },
      {
        "id": "115",
        "title": "Add comprehensive error handling and logging",
        "description": "Implement robust error handling and logging across all sync mechanisms for monitoring and debugging",
        "details": "Add comprehensive error handling to all sync functions with appropriate fallbacks. Implement structured logging for sync operations including success/failure counts, timing metrics, and error details. Add monitoring for sync failures and performance. Ensure errors in one user's sync don't affect others in batch operations.",
        "testStrategy": "Test error scenarios like network failures, invalid data, and rate limiting. Verify logs provide sufficient detail for debugging. Confirm batch operations continue processing after individual failures. Test monitoring alerts trigger appropriately.",
        "priority": "medium",
        "dependencies": [
          "103",
          "104",
          "105"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "116",
        "title": "Create integration tests for complete sync flow",
        "description": "Develop comprehensive integration tests covering all sync mechanisms and edge cases",
        "details": "Create integration tests covering: lazy sync on app open, cron job execution, enrollment sync, cross-program interference prevention, and cycle-based functionality. Test timezone handling, duplicate prevention, error scenarios, and backward compatibility. Include performance tests for batch operations and large datasets.",
        "testStrategy": "Run full integration test suite covering all sync scenarios. Test with multiple timezones, large user bases, and various program configurations. Verify no regressions in existing functionality. Confirm performance meets requirements under load.",
        "priority": "low",
        "dependencies": [
          "103",
          "104",
          "105",
          "106"
        ],
        "status": "pending",
        "subtasks": []
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2026-01-08T12:52:28.082Z",
      "taskCount": 15,
      "completedCount": 12,
      "tags": [
        "master"
      ]
    }
  }
}