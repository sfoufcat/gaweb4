{
  "master": {
    "tasks": [
      {
        "id": "78",
        "title": "Fix calculateDateForProgramDay Bug",
        "description": "Fix the critical RangeError in calculateDateForProgramDay function that crashes when enrollment.startedAt is undefined, blocking coach-to-client sync",
        "details": "In src/lib/program-engine.ts at line 2671, add null/undefined checks for startDateStr parameter at the beginning of the calculateDateForProgramDay function. Add validation using isNaN(startDate.getTime()) to detect invalid Date objects. Return null instead of crashing when date is invalid. Add console.warn logging for debugging purposes. This fix will unblock the already deployed coach-to-client sync code that currently fails silently.",
        "testStrategy": "Unit tests with undefined startDateStr, invalid date strings, and valid dates. Verify function returns null for invalid inputs and correct dates for valid inputs. Test coach program edits to ensure sync no longer crashes.",
        "priority": "high",
        "dependencies": [],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-07T20:47:15.410Z"
      },
      {
        "id": "79",
        "title": "Implement Lazy Sync on Task Fetch",
        "description": "Add automatic program task sync when users fetch their tasks, ensuring timezone-aware delivery without manual intervention",
        "details": "Modify src/app/api/tasks/route.ts GET endpoint to check if user has active program enrollment and existing program tasks for today. If no program tasks exist with source: 'program' for today, call syncProgramV2TasksForToday(userId) in background. Implement error handling to ensure task fetch succeeds even if sync fails. Use existing programTaskExistsV2() function to prevent duplicates. This provides natural timezone handling as tasks sync when user needs them.",
        "testStrategy": "Test with users in different timezones opening app. Verify program tasks appear automatically. Test error scenarios where sync fails but task fetch still works. Verify no duplicate tasks are created.",
        "priority": "high",
        "dependencies": [
          "78"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-07T20:48:31.134Z"
      },
      {
        "id": "80",
        "title": "Create Backup Cron Job for Program Sync",
        "description": "Implement a backup cron job running every 6 hours to ensure users who don't open the app still receive program tasks for push notifications",
        "details": "Create new file src/app/api/cron/programs-daily-sync/route.ts with POST handler. Fetch all active enrollments where status === 'active'. For each enrollment, check if user has program tasks for today using programTaskExistsV2(). If not, call syncProgramV2TasksForToday(userId). Implement batching for >1000 enrollments to avoid overwhelming Firestore. Add rate limiting and comprehensive logging. Update vercel.json with cron schedule '0 */6 * * *' for 0:00, 6:00, 12:00, 18:00 UTC.",
        "testStrategy": "Test cron execution with mock enrollments. Verify batching works with large datasets. Test error handling for individual user sync failures. Monitor logs for successful execution and performance metrics.",
        "priority": "medium",
        "dependencies": [
          "78"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-07T20:49:27.590Z"
      },
      {
        "id": "81",
        "title": "Add Program Sync on Enrollment",
        "description": "Automatically sync program tasks when users enroll in programs, ensuring Day 1 tasks appear immediately",
        "details": "Modify src/app/api/programs/enroll/route.ts and src/app/api/programs/complete-enrollment/route.ts to trigger sync after creating active enrollment. Check if start date (cohort.startDate or enrollment.startedAt) is today or in the past. If so, call syncProgramV2TasksForToday(userId). Implement graceful error handling - enrollment should succeed even if sync fails. Add logging for sync success/failure during enrollment process.",
        "testStrategy": "Test enrollment flow with immediate task sync. Verify Day 1 tasks appear for new enrollees. Test error scenarios where sync fails but enrollment completes successfully. Test both direct enrollment and post-payment enrollment paths.",
        "priority": "high",
        "dependencies": [
          "78"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-07T20:50:45.330Z"
      },
      {
        "id": "82",
        "title": "Update Vercel Configuration for Cron",
        "description": "Configure Vercel cron jobs to enable the backup program sync functionality",
        "details": "Update vercel.json file to include cron configuration for the programs-daily-sync endpoint. Add cron object with path '/api/cron/programs-daily-sync' and schedule '0 */6 * * *' to run every 6 hours at 0:00, 6:00, 12:00, and 18:00 UTC. Ensure proper formatting and syntax for Vercel cron jobs. This enables the backup sync mechanism for users who don't actively open the app.",
        "testStrategy": "Deploy configuration and verify cron job appears in Vercel dashboard. Monitor cron execution logs. Test manual trigger of cron endpoint to ensure it works before automated scheduling.",
        "priority": "medium",
        "dependencies": [
          "80"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-07T20:49:27.593Z"
      },
      {
        "id": "83",
        "title": "Integration Testing and Monitoring Setup",
        "description": "Implement comprehensive testing and monitoring for the complete program task sync architecture",
        "details": "Create end-to-end tests covering all sync scenarios: lazy sync on app open, enrollment sync, cron backup sync, and coach edit sync. Set up monitoring and alerting for sync failures. Add metrics tracking for sync success rates, performance, and user coverage. Test timezone edge cases and high-load scenarios. Verify the complete architecture works as designed with no task duplication and proper error handling.",
        "testStrategy": "End-to-end testing with real user scenarios across different timezones. Load testing with multiple concurrent syncs. Monitor sync success rates and performance metrics. Test failure scenarios and recovery mechanisms.",
        "priority": "medium",
        "dependencies": [
          "79",
          "81",
          "82"
        ],
        "status": "pending",
        "subtasks": []
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2026-01-07T20:50:45.330Z",
      "taskCount": 6,
      "completedCount": 5,
      "tags": [
        "master"
      ]
    }
  }
}